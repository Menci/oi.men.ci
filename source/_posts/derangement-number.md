title: 全错位排列递推公式的推导
categories: OI
tags: 
  - 数学
  - 学习笔记
  - 错位排列
permalink: derangement-number
date: 2016-04-13 15:41:16
---

将按照顺序排列的 $ 1 $ ~ $ n $ 打乱，重新排列，要求每个元素都不能在自己原有的位置上，求方案总数。

<!-- more -->

设答案为 $ f(n) $。

首先考虑第 $ n $ 号位置上放哪个元素，有 $ n - 1 $ 种方案，假设放的是 $ 1 $；

考虑把 $ n $ 号元素放在哪个位置，如果我们删掉 $ n $ 号位置（不再考虑原有的 $ 1 $ 号元素），然后把 $ n $ 号元素的标号改为 $ 1 $，这样问题就成为了一个子问题 $ f(n - 1) $。

但是这样考虑是有问题的 —— 原有的 $ n $ 号元素被编号为 1 后，就再也不可能被放到 1 号位置了，但原问题中，这是一种可行方案，所以要把这种情况加上。如果把 $ n $ 号元素放到 1 号位置，可以不再考虑这两个位置，问题转化为另一个子问题 $ f(n - 2) $。

这样，我们得到一个递推式

$$ f(n) = (n - 1) \times (f(n - 1) + f(n - 2)) $$
